<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Tactile Experiment Assistant v2</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; background-color: #f8f9fa; }
        #container { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); text-align: center; width: 450px; }
        #status { font-size: 24px; font-weight: bold; color: #3c4043; margin-bottom: 30px; min-height: 36px; }
        .progress-bar { width: 100%; height: 20px; background: #e8eaed; border-radius: 10px; overflow: hidden; margin-bottom: 10px; position: relative; }
        #progress { width: 0%; height: 100%; background: #1a73e8; transition: width 0.1s linear; }
        /* 1초마다 깜빡이는 인디케이터 */
        #flash { width: 100%; height: 100%; position: absolute; top: 0; left: 0; background: rgba(255,255,255,0.5); opacity: 0; pointer-events: none; }
        .flash-active { animation: blink 0.2s; }
        @keyframes blink { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; } }

        button { padding: 15px 30px; font-size: 18px; cursor: pointer; background: #1a73e8; color: white; border: none; border-radius: 8px; transition: 0.2s; width: 100%; }
        button:hover { background: #174ea6; }
        button:disabled { background: #dadce0; cursor: not-allowed; }

        #input-section { display: none; margin-top: 30px; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        input { padding: 12px; width: 80px; font-size: 20px; text-align: center; border: 2px solid #1a73e8; border-radius: 8px; margin-bottom: 15px; }
        #log { margin-top: 30px; text-align: left; font-size: 14px; max-height: 120px; overflow-y: auto; background: #f1f3f4; padding: 15px; border-radius: 8px; color: #5f6368; }
    </style>
</head>
<body>

<div id="container">
    <div id="status">Experiment Setup</div>
    
    <div class="progress-bar">
        <div id="progress"></div>
        <div id="flash"></div>
    </div>
    <div style="font-size: 12px; color: #9aa0a6; margin-bottom: 30px;">20s Progress Bar</div>
    
    <button id="startBtn" onclick="startExperiment()">시행 시작 (Start Trial)</button>

    <div id="input-section">
        <div style="margin-bottom: 10px; font-weight: bold;">Counts</div>
        <input type="number" id="responseCount" autofocus> <br>
        <button onclick="saveResult()" style="background: #34a853;">Save</button>
    </div>

    <div id="log"><strong>Recent Status:</strong><br></div>
</div>

<script>
    let timeLeft = 20;
    let timerInterval;
    const statusDisplay = document.getElementById('status');
    const progressDisplay = document.getElementById('progress');
    const flashDisplay = document.getElementById('flash');
    const startBtn = document.getElementById('startBtn');
    const inputSection = document.getElementById('input-section');
    const logSection = document.getElementById('log');

    function startExperiment() {
        timeLeft = 20;
        startBtn.disabled = true;
        startBtn.style.display = 'none';
        inputSection.style.display = 'none';
        statusDisplay.innerText = "Ing...";
        statusDisplay.style.color = "#1a73e8";

        let lastSecond = 20;

        timerInterval = setInterval(() => {
            timeLeft -= 0.1;
            
            // 1초마다 바(Bar) 깜빡임 효과 (자극 타이밍 가이드)
            if (Math.floor(timeLeft) < lastSecond) {
                flashDisplay.classList.remove('flash-active');
                void flashDisplay.offsetWidth; // 리플로우 트리거
                flashDisplay.classList.add('flash-active');
                lastSecond = Math.floor(timeLeft);
            }

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                finishTrial();
            }
            updateDisplay();
        }, 100);
    }

    function updateDisplay() {
        progressDisplay.style.width = ((20 - timeLeft) / 20 * 100) + "%";
    }

    function finishTrial() {
        statusDisplay.innerText = "Please Type.";
        statusDisplay.style.color = "#34a853";
        inputSection.style.display = 'block';
        document.getElementById('responseCount').focus();
    }

    function saveResult() {
        const count = document.getElementById('responseCount').value;
        if(count === "") return;
        
        const now = new Date().toLocaleTimeString();
        logSection.innerHTML += `[${now}] 응답: ${count}회<br>`;
        
        // 초기화
        document.getElementById('responseCount').value = "";
        inputSection.style.display = 'none';
        startBtn.disabled = false;
        startBtn.style.display = 'block';
        statusDisplay.innerText = "Next";
        statusDisplay.style.color = "#3c4043";
        progressDisplay.style.width = "0%";
    }
</script>

</body>
</html>
